<%- include("templates/header-beforeLogin") %>
  <main class="form-wrapper signin">
    <form action='/reset-password-submit' method='post' class="needs-validation" novalidate>
      <h1 class="h3 fw-normal">Reset Password</h1>

      <div class="profile-summary">
        <%- include("templates/profile-avatar", {avatar}) %>
          <span class="user-id">Welcome back, <%= username %></span>
      </div>
      <input type="hidden" name="token" id="token" value="<%= token %>">

      <div class="form-floating">
        <input name="password1" type="password" class="form-control" id="password1" placeholder="Password" required>
        <label for="password1">New Password</label>
        <div class="invalid-feedback">
          Please enter a new password
        </div>
      </div>

      <div class="form-floating">
        <input name="password2" type="password" class="form-control" id="password2" placeholder="Confirm Password"
          required>
        <label for="password2">Confirm Password</label>
        <div class="invalid-feedback">
          Please confirm your password
        </div>
      </div>

      <div class="sign-btns-container">
        <button class="w-100 btn btn-lg btn-primary" type="submit">Save</button>
      </div>
    </form>
  </main>
  <%- include("templates/footer") %>



    <script>
      /*
     This code handles password validation and form submission by comparing the values 
     of "password1" and "password2" HTML elements and displaying custom validation feedback. 
     It is designed for web pages with "needs-validation" forms that require password validation 
     and submission handling.
  */

      // Password validation and form submission handling
      const password1 = document.getElementById('password1');
      const password2 = document.getElementById('password2');

      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);

      // Event listener for input changes in the password2 field
      password2.addEventListener('input', () => {
        if (password1.value !== password2.value) {
          password2.setCustomValidity('Passwords must match.');
        } else {
          password2.setCustomValidity('');
        }
      });

      const form = document.querySelector('.needs-validation');

      // Event listener for form submission
      form.addEventListener('submit', (event) => {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
        }

        form.classList.add('was-validated');
      });


    </script>

    <%- include("templates/footer") %>